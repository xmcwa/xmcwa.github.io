---
title: 数据结构做题笔记
description: 
slug: note-ds
date: 2023-10-04
image: cover.jpg
categories:
    - programming
    - exercise
tags:
    - Data Structure
---

## 线段树

### 楼房重建

#### 题意
给定一个数列 $a$，求 $a$ 的前缀 $\max$ 数组中有多少个不同的值。

#### 做法
每个线段树节点维护当前区间的前缀 $\max$  中有多少不同的值，设 $query(rt,l,r,k)$ 表示线段树节点 $rt$，对应数列 $[l,r]$ 区间，求前缀 $\max$ 中有多少不同的 $>k$ 的元素。如果左儿子的最大值小于等于 $k$ 则直接递归到右子树，否则递归到左子树并将答案加上 $ans_{rt}-ans_{ls}$。

### P3792 由乃与大母神原型和偶像崇拜

#### 题意
给你一个数列 $a$。支持两种操作
1. 单点修改
2. 询问区间 $[l,r]$ 是否是值域连续的一段

#### 做法
维护区间最小值、最大值和元素的平方和。直接判断即可。

### P5607 [Ynoi2013] 无力回天 NOI2017

#### 题意
给你一个数列 $a$，操作为把 $[l,r]$ 都异或 $v$，或查询 $[l,r]$ 选若干个数异或起来的最大值。

#### 做法
考虑 $a$ 的异或差分为 $b$，这样修改变为了单点修改，不难发现 $a_{[l,r]}$ 和 $a_l\cup b_{[l+1,r]}$ 的线性基是相等的，用线段树维护即可。

## 主席树

### P3168 [CQOI2015] 任务查询系统

#### 题意
有若干个任务 $(s_i,e_i,p_i)$ 代表任务 $i$ 从 $s_i$ 时刻开始，$e_i$ 时刻结束，优先级为 $p_i$。

给定若干个询问，求 $i$ 时刻优先级前 $k$ 小的任务优先级之和。询问强制在线。

#### 做法
用主席树维护每个时刻的任务，主席树上二分即可。

### P4602 [CTSC2018] 混合果汁

#### 题意
有 $n$ 瓶果汁和 $m$ 个小朋友，每瓶果汁 $(d_i,p_i,l_i)$ 表示果汁美味度为 $d_i$，每瓶价格为 $p_i$，每个小朋友最多拿 $l_i$ 瓶；每个小朋友 $(g_i,L_i)$ 表示他有 $g_i$ 元钱，需要至少 $L_i$ 升果汁。定义果汁的集合的美味度为集合中果汁美味度最小值，求每个小朋友美味度最大是多少。

#### 做法
用主席树维护美味度 $\ge x$ 的果汁的价格，二分答案，二分 `check` 时贪心选价格最小的果汁。

### P2633 Count on a tree

#### 题意
给定一棵 $n$ 个节点的树，每个点有一个权值。有 $m$ 个询问，每次给你 $u,v,k$，你需要回答 $u \text{ xor last}$ 和 $v$ 这两个节点间第 $k$ 小的点权。

其中 $\text{last}$ 是上一个询问的答案，定义其初始为 $0$，即第一个询问的 $u$ 是明文。

#### 做法
考虑主席树，每个节点维护它到树根的链上的信息，树上差分转化为区间第 $k$ 小。

## 线段树合并

### P4556 [Vani有约会] 雨天的尾巴

#### 题意
给定一棵树，每次将 $x$ 到 $y$ 路径上所有点加上一个 $z$ 类型物品，所有操作后求每个节点最多的是哪种物品。

#### 做法
每个节点开一颗线段树，树上差分，每次操作把 $x$ 和 $y$ 节点对应的树 $z$ 位置加 $1$，$\mathrm{lca}$ 和它的父节点对应的树 $z$ 位置减 $1$。最后线段树合并，每次选一个叶子节点合并到父亲上。

## 树套树 / CDQ 分治 / 整体二分

### P2617 Dynamic Rankings

#### 题意
给定一个含有 $n$ 个数的序列 $a_1,a_2,\cdots,a_n$​，需要支持两种操作：

-   `Q l r k` 表示查询下标在区间 $[l,r]$ 中的第 $k$ 小的数
-   `C x y` 表示将 $a_x$ 改为 $y$

#### 做法

##### 整体二分做法
首先，我们将原数组的 $n$ 个值看作 $n$ 次插入操作，将修改操作看作一次删除操作和一次插入操作，那么所有操作都可以转化为插入、删除、查询操作。将这些操作按时间发生顺序放入队列中。这些是预处理操作。

之后开始整体二分。定义函数 $\mathrm{solve}(l,r,S)$ 表示处理操作序列 $S$ 中的修改，并将 $S$ 内的询问求出答案，答案的范围为 $[l,r]$。

显然，对于 $\mathrm{solve}$ 函数，如果 $l=r$，那么序列 $S$ 中的所有查询操作答案都为 $l$。否则：

具体的，用树状数组维护整个数组中小于 $mid$ 的值，若 $l\le a_x<mid$ 则树状数组 $x$ 的位置为 $1$，否则为 $0$。我们遍历整个操作序列，对于修改操作，如果修改的值小于 $l$ 或大于 $r$ 就忽略，否则在树状数组对应位置进行对应修改，并将修改的值小于等于 $mid$ 的修改放到左区间 $S_l$，大于 $mid$ 的修改放到右区间 $S_r$；对于询问操作，在树状数组上查询此时询问区间内的和 $cnt$，若 $k\le cnt$ 则将询问放到左区间 $S_l$，否则将 $k$ 减去 $cnt$ 后放到右区间 $S_r$。

然后进行递归，处理 $\mathrm{solve}(l,mid,S_l)$ 和 $\mathrm{solve}(mid+1,r,S_r)$。

##### 树套树做法
首先考虑静态区间第 $k$ 小问题，我们可以对每个前缀开权值线段树，那么一个区间就相当于两个前缀做差。考虑到相邻两个前缀只有一个值不同，用主席树优化。

回到这个问题，我们可以用树状数组套权值线段树。先对序列开一个树状数组，树状数组的每个节点对应一颗权值线段树，维护这个节点对应区间的信息。这样，任意一个区间都可以拆成 $O(\log n)$ 棵树的和。单次操作复杂度为 $O(\log^2n)$

### P3332 K大数查询

#### 题意
你需要维护 $n$ 个可重整数集，集合的编号从 $1$ 到 $n$。  
这些集合初始都是空集，有 $m$ 个操作：

-   `1 l r c`：表示将 cc 加入到编号在 $[l,r]$ 内的集合中
-   `2 l r c`：表示查询编号在 $[l,r]$ 内的集合的并集中，第 $c$ 大的数是多少。

注意可重集的并是不去除重复元素的，如 $\{1,1,4\}\cup\{5,1,4\}=\{1,1,4,5,1,4\}$。

#### 做法
考虑整体二分，用线段树维护一个序列，对于每个修改操作，如果 $c<mid$ 就将线段树上区间 $[l,r]$ 加 $1$，对于每个询问操作，在线段树上查询 $[l,r]$ 的区间和 $cnt$，如果 $cnt$ 小于等于 $c$ 就向左递归，否则向右。

### P1975 [国家集训队] 排队

#### 题意
给定一个长为 $n$ 的序列 $a$，每次操作给定 $l,r$，交换 $a_l$ 和 $a_r$，每次操作后请你求出 $a$ 的逆序对数量。

#### 做法
题目等价于求区间内小于 $k$ 的元素数量，支持单点修改。

类似 `Dynamic Rankings`，可以用树状数组套权值线段树做，查询时将区间拆成若干棵树的和。

弱化版：P3157 [CQOI2011] 动态逆序对
